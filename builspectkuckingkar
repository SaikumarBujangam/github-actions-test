##########################
# creating Lambda Function
###########################


resource "aws_lambda_function" "lambda_dynamodb_stream" {
  function_name = var.lambda_function_name
  description   = "Dynamodb stream"
  memory_size   = "512"
  timeout       = "300"
  ephemeral_storage {
    size = "2048"
  }
  role         = aws_iam_role.lambda_role.arn
  runtime      = "python3.9"
  handler      = "lambda_function.lambda_handler"
  package_type = "Zip"

  #s3_bucket         = aws_s3_bucket.bucket.id
  #s3_key            = "lambda/lambda_function.zip"  
  s3_bucket         = module.lambda-s3.id
  s3_key            = "lambda/lambda_function.zip" 
}

resource "aws_lambda_event_source_mapping" "dynamodb_stream_lambda_mapping" {
  
  event_source_arn       = var.dynamodb_arn
  function_name          = aws_lambda_function.lambda_dynamodb_stream.arn
  maximum_retry_attempts = var.cloudsearch_stream_maximum_retry_attempts
  starting_position      = "LATEST"
}

module "lambda-s3" {
  source      = "../aws-common/s3"

  bucket_name = "${var.platform}-${var.env}-dynamodb_stream"
}

rror: Unsupported attribute
│
│   on lambda.tf line 21, in resource "aws_lambda_function" "lambda_dynamodb_stream":
│   21:   s3_bucket         = module.lambda-s3.bucket_name
│     ├────────────────
│     │ module.lambda-s3 is a object, known only after apply
│
│ This object does not have an attribute named "bucket_name".
╵
time=2023-09-21T10:50:24+05:30 level=error msg=Terraform invocation failed in C:/.terragrunt-cache/4EjCFoLUepVr4mMWBW-pKLhmKTw/3i_WC85hFbG0RGQjdTVce7dxmn4/platform-backend prefix=[C:\Users\umababy.kannan\OneDrive - HCL Technologies Ltd\Documents\Star CAP\clone\platform-infra\platform-infra\live\dev2\eu-west-1\platform-backend]

time=2023-09-21T10:50:32+05:30 level=info msg=
 Error: Unsupported attribute
│
│   on lambda.tf line 21, in resource "aws_lambda_function" "lambda_dynamodb_stream":
│   21:   s3_bucket         = module.lambda-s3.id
│     ├────────────────
│     │ module.lambda-s3 is a object, known only after apply
│
│ This object does not have an attribute named "id".
