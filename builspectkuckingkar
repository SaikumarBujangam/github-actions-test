- name: Add Secrets to New Repository
  env:
    GH_TOKEN: ${{ secrets.GH_CLONE_REPO }}
    github_user: ${{ secrets.GH_USER_NAME }}
    SOURCE_REPO: 'AlightEngineering/adl-awsdeploy-cicd'
    TARGET_REPO: ${{ inputs.org-name }}/${{ inputs.repo-division-name }}-${{ inputs.repo-group-name }}-${{ inputs.repo-subject-area }}
  run: |
    # Add GH_TOKEN secret
    gh secret set GH_TOKEN --repo $TARGET_REPO --body "${GH_TOKEN}"

    # Add github_user secret
    gh secret set github_user --repo $TARGET_REPO --body "${github_user}"

    # Add github_token secret
    gh secret set github_token --repo $TARGET_REPO --body "${GH_TOKEN}"

    # List secrets in the source repository
    secrets_list=$(gh secret list -R $SOURCE_REPO --json name)
    
    # Retrieve ADL_ARTIFACTORY_TOKEN secret from source repository
    ADL_ARTIFACTORY_TOKEN_SOURCE=$(echo $secrets_list | jq -r '.[] | select(.name=="ADL_ARTIFACTORY_TOKEN") | .value')
    
    # Set ADL_ARTIFACTORY_TOKEN secret in the target repository
    gh secret set ADL_ARTIFACTORY_TOKEN --repo $TARGET_REPO --body "${ADL_ARTIFACTORY_TOKEN_SOURCE}"

    # Retrieve ADL_ARTIFACTORY_USER_NAME secret from source repository
    ADL_ARTIFACTORY_USER_NAME_SOURCE=$(echo $secrets_list | jq -r '.[] | select(.name=="ADL_ARTIFACTORY_USER_NAME") | .value')

    # Set ADL_ARTIFACTORY_USER_NAME secret in the target repository
    gh secret set ADL_ARTIFACTORY_USER_NAME --repo $TARGET_REPO --body "${ADL_ARTIFACTORY_USER_NAME_SOURCE}"
