resource "kubernetes_config_map" "datadog_yaml" {
  for_each = toset(var.dd_sidecar_namespaces)
  metadata {
    name = "datadog-config"
    namespace = each.key
  }

  data = {
    "datadog.yaml" =<<EOF
apm_config:
  apm_non_local_traffic: true
  ignore_resources: ["(GET|POST) /healthCheck"]
tags:
  - env:${var.env}
  - product:${var.product}
  - component:${var.component}
logs_enabled: true
inventories_configuration_enabled: true
jmx_use_container_support: true
process_config:
  process_collection:
    enabled: true   
otlp_config:
  receiver:
    protocols:
      grpc:
        endpoint: localhost:4317
      http:
        endpoint: localhost:4318
EOF
  }
}
