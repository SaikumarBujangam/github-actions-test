locals {
  config_mgmt_build_data = [
    for name in var.short_name : {
      build_project_name              = "${name}-configmap-update-utility"
      build_spec_file                 = "${path.cwd}/build_spec/${name}-configmap-update-buildspec.yml"
      # ... other attributes
    }
  ]

  microservices_restart_build_data = [
    for name in var.short_name : {
      build_project_name              = "${name}-microservices-restart-utility"
      build_spec_file                 = "${path.cwd}/build_spec/${name}-microservices-restart-utility.yml"
      # ... other attributes
    }
  ]
}

module "config_mgmt_build" {
  count = length(var.short_name)
  source = "../../aws-common/codebuild"

  build_project_name              = local.config_mgmt_build_data[count.index].build_project_name
  build_spec_file                 = local.config_mgmt_build_data[count.index].build_spec_file
  # ... other attributes
}

module "microservices_restart_build" {
  count = length(var.short_name)
  source = "../../aws-common/codebuild"

  build_project_name              = local.microservices_restart_build_data[count.index].build_project_name
  build_spec_file                 = local.microservices_restart_build_data[count.index].build_spec_file
  # ... other attributes
}
