 provisioner "local-exec" {
    command = <<-EOT
      INSTANCE_ID="${var.instance_id}"
      REGION="${var.aws_region}"
      NEW_SIZE="${var.new_size}"

      VOLUME_ID=$(aws ec2 describe-volumes --filters "Name=attachment.instance-id,Values=$INSTANCE_ID" "Name=attachment.device,Values=/dev/sda1" --query "Volumes[*].VolumeId" --output text --region "$REGION")
      aws ec2 modify-volume --volume-id $VOLUME_ID --size $NEW_SIZE --region $REGION
    EOT
  }
}
