name: ADL CICD Checkout Repository Phase

on:
  workflow_call:
    secrets:
      envPAT:
        required: true
    inputs:
      cicd_version:
        description: 'CICD Stable Release Version'
        type: string
        required: false
        default: 'd1.0.288'
jobs:
  adl-checkout-calling-repo:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Checkout Requesting Repository Branch
      run: |
        echo "Checking out Repository: " $GITHUB_REPOSITORY
        echo "Checking out Branch: " $GITHUB_REF_NAME
  adl-dispatch-aws-deploy-workflow:
    needs:
      adl-checkout-calling-repo
    runs-on: ubuntu-latest
    steps:
    - name: Trigger Deploy
      run: |
        curl -X POST https://api.github.com/repos/AlightEngineering/adl-awsdeploy-cicd/dispatches \
          -H "Authorization: Bearer ${{ secrets.envPAT }}" \
          -H 'Accept: application/vnd.github.everest-preview+json' \
          --data '{"event_type": "adl-aws-deploy", "client_payload": { "name": "'"$GITHUB_REPOSITORY"'", "branch": "'"$GITHUB_REF_NAME"'", "cicd_version": "${{ inputs.cicd_version }}" }'
