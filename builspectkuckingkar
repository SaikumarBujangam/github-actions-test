import subprocess
import sys

instance_id = sys.argv[1]
region = sys.argv[2]

# Run AWS CLI commands using subprocess
instance_id_cmd = f"aws ec2 describe-instances --filters Name=instance-id,Values={instance_id} --query 'Reservations[*].Instances[*].InstanceId' --output text --region {region}"
instance_id = subprocess.getoutput(instance_id_cmd)

volume_id_cmd = f"aws ec2 describe-volumes --filters Name=attachment.instance-id,Values={instance_id} --query 'Volumes[*].VolumeId' --output text --region {region}"
volume_id = subprocess.getoutput(volume_id_cmd)

modify_volume_cmd = f"aws ec2 modify-volume --volume-id {volume_id} --size 50 --region {region}"
subprocess.run(modify_volume_cmd, shell=True)


resource "null_resource" "resize_root_volume" {
  depends_on = [aws_cloud9_environment_ec2.cloud9_ide]

  provisioner "local-exec" {
    command = "python3 ${path.module}/resize_volume.py ${data.aws_instance.cloud9.id} ${var.region}"
  }
}
