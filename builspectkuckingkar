  # Dynamically add GSI hash_key attributes
  dynamic "attribute" {
    for_each = {for gsi in var.global_secondary_indexes : gsi.hash_key => "S"}
    content {
      name = each.key
      type = each.value
    }
  }

  # Dynamically add GSI range_key attributes, only if they exist
  dynamic "attribute" {
    for_each = {for gsi in var.global_secondary_indexes : gsi.range_key => "S" if gsi.range_key != null}
    content {
      name = each.key
      type = each.value
    }
  }

  # Global Secondary Indexes
  dynamic "global_secondary_index" {
    for_each = var.global_secondary_indexes
    content {
      name             = global_secondary_index.value.name
      hash_key         = global_secondary_index.value.hash_key
      projection_type  = global_secondary_index.value.projection_type
      
      # Only set range_key if it's not null, otherwise, omit it
      range_key = global_secondary_index.value.range_key != null ? global_secondary_index.value.range_key : null
    }
  }

