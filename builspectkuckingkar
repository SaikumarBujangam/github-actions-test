# Define the Lambda function
resource "aws_lambda_function" "lambda_dynamodb_stream" {
  function_name = var.lambda_function_name
  description   = "Dynamodb stream"
  memory_size   = "512"
  timeout       = "300"
  ephemeral_storage {
    size = "2048"
  }
  role         = aws_iam_role.lambda_role.arn
  runtime      = "python3.9"
  handler      = "lambda_function.lambda_handler"

  # Use the local .py file as the Lambda function's code
  filename = "${path.module}/lambda_code/lambda_function.py"  # Adjust the path as needed

  environment {
    variables = {
      # Add any environment variables your Lambda function requires
      EXAMPLE_VARIABLE = "example-value"
    }
  }
}

resource "aws_lambda_event_source_mapping" "dynamodb_stream_lambda_mapping" {
  event_source_arn       = module.lambda-dynamodb.dynamodb_table_arn
  function_name          = aws_lambda_function.lambda_dynamodb_stream.arn
  maximum_retry_attempts = var.cloudsearch_stream_maximum_retry_attempts
  starting_position      = "LATEST"
}
