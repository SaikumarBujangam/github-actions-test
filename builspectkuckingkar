resource "null_resource" "resize_root_volume" {
  depends_on = [aws_cloud9_environment_ec2.cloud9_ide]

  provisioner "local-exec" {
    command = <<EOF
      INSTANCE_ID=$(aws ec2 describe-instances --filters "Name=tag:aws:cloud9:environment,Values=${aws_cloud9_environment_ec2.cloud9_ide.id}" "Name=instance-state-name,Values=running" --query "Reservations[*].Instances[*].InstanceId" --output text --region ${var.region})
      VOLUME_ID=$(aws ec2 describe-volumes --filters "Name=attachment.instance-id,Values=$INSTANCE_ID" "Name=attachment.device,Values=/dev/xvda" --query "Volumes[*].VolumeId" --output text --region ${var.region})
      aws ec2 modify-volume --volume-id $VOLUME_ID --size 50 --region ${var.region}
    EOF
  }
}
