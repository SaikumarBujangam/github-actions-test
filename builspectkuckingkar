module "docker_build" {
  source = "../../terraform-modules/terraform-aws-codebuild"

  create_build_project = local.create_build_project

  build_project_name     = "${var.project_key}-cc-repo-docker-build"
  build_spec_file        = "${path.module}/build_spec/docker-build.yml"
  codebuild_role_arn     = aws_iam_role.codebuild_role.arn
  source_location        = module.project_codecommit[0].codecommit_repo_clone_url_http

  build_specific_variables = {
    "ecr_repository_url" = module.project_ecr[0].ecr_repo_url
  }

  tags = merge(
    {
      "organization" = "${var.org_key}"
    },
    {
      "platform" = "${var.org_key}"
    },
    {
      "project_key" = "${var.project_key}"
    },
  )
}

locals {
  create_build_project = var.create_build_project  # Set this variable to control the creation of the CodeBuild project
}
