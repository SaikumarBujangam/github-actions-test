# This is necessary for Datadog to post metrics
resource "helm_release" "dd_cluster_agent" {

  namespace = var.dd_cluster_agent_namespace
  wait      = true
  timeout   = 600

  name = "datadog"

  repository = "https://helm.datadoghq.com"
  chart      = "datadog"
  version    = "v3.40.0"

  values     = [
    templatefile("${path.module}/values/dd-cluster-agent-values.yaml", {
      cluster_name   = var.cluster_name
      datadog_url    = var.datadog_url
      env            = var.env
      component      = var.component
      product        = var.product
      datadog_secret = var.datadog_secret_name
    })
  ]
}
