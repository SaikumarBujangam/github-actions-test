stages:
  - sonar-check
  - merge-check
  
sonar-check:
  stage: sonar-check
  image: sonarsource/sonar-scanner-cli:latest
  variables:
    SONAR_TOKEN: $SONAR_TOKEN
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"
    GIT_DEPTH: "0"
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script:
    - sonar-scanner -Dsonar.projectKey=starcap-devops-infra -Dsonar.sources=. -Dsonar.qualitygate.wait=true -Dsonar.host.url=https://sonarqube.roche.com -Dsonar.login=sqa_6cfeeb90e46e9f88af70d6b63b0d8894ae033309

  only:
    refs:
        - merge_requests
    variables:
        - ($CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "feature/merge-request-sonar-analysis" || $CI_MERGE_REQUEST_TARGET_BRANCH_NAME =="feature/test-branch")

merge-check:
  stage: merge-check
  script: 
    - echo "pipeline success"
  only:
    refs:
        - merge_requests
    variables:
        #if !["feature/merge-request-sonar-analysis" || "feature/test-branch"]
#         - $CI_MERGE_REQUEST_TARGET_BRANCH_NAME 
       - ($CI_MERGE_REQUEST_TARGET_BRANCH_NAME != "feature/merge-request-sonar-analysis" || $CI_MERGE_REQUEST_TARGET_BRANCH_NAME =="feature/test-branch")
      # - $CI_MERGE_REQUEST_TARGET_BRANCH_NAME != "feature/merge-request-sonar-analysis" 

  
