stages:
  - sonar-check
  
sonar-check:
  stage: sonar-check
  image: sonarsource/sonar-scanner-cli:latest
  variables:
    SONAR_TOKEN: $SONAR_TOKEN
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"
    GIT_DEPTH: "0"
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script:
    - sonar-scanner -Dsonar.projectKey=starcap-devops-infra -Dsonar.sources=. -Dsonar.qualitygate.wait=true -Dsonar.host.url=https://sonarqube.roche.com -Dsonar.login=sqa_6cfeeb90e46e9f88af70d6b63b0d8894ae033309
  #only:
  rules:
    - if: '$CI_COMMIT_REF_NAME == "feature/merge-request-sonar-analysis" && $CI_PIPELINE_SOURCE == "merge_request_event"'
    - when: always
    #- when: never
    
    #- merge_requests
    #- main
